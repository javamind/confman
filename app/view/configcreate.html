<material-content style="top:128px" ng-controller="configCreateCtrl">
    <div class="confman-accroche">
        A new configuration is created from an application version number. <b>Confman</b> display
        a form with the last known values (last version tracking for the actual application
        version number). You can change every parameters values but you won't be able to change
        them after the saving. We choose this policy because all the changes have to be followed.
    </div>
    <div class="confman-error" ng-show="error">
        Error : {{error.message}}
    </div>
    <form class="form confman-form" name="form" novalidate>
        <div class="container-fluid thumbnail">
            <div class="row">
                <div class="col-md-1">
                    <label for="data-application">&nbsp;Application</label>
                </div>
                <div class="col-md-3">
                    <select id="data-application" ng-model="criteria.idApplication" class="form-control" required
                            ng-change="changeApplication()" name="application"
                            ng-options="application.id as application.code for application in applications">
                        <option value="">Application</option>
                    </select>
                    <span ng-show="form.application.$error.required">Application is required</span>
                </div>
                <div class="col-md-1">
                    <label for="data-tracking">&nbsp;Version</label>
                </div>
                <div class="col-md-3">
                    <select id="data-tracking" ng-model="criteria.idApplicationVersion" class="form-control" required
                            name="applicationVersion"
                            ng-options="applicationVersion.id as applicationVersion.code for applicationVersion in applicationVersions">
                        <option value="">Versions</option>
                    </select>
                    <span ng-show="form.applicationVersion.$error.required">application version is required</span>
                </div>
                <div class="col-md-4">
                    <div class="confman-btn">
                        <button class="btn btn-primary" ng-click="createParametersValues()" ng-disabled="form.$invalid">
                            <img src="../img/icon/ic_add_24px.svg" title="Create"/>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" ng-show="versionTrackiCode">
            <div class="col-md-12">
                <h3>Version tracking <b>{{versionTrackiCode}}</b></h3>
                Change the values or delete lines if necessary and click on the save button. After, this version
                tracking will be locked and no
                parameter value won't be able to change
            </div>
        </div>
        <material-tabs selected="selectedIndex" noink ng-show="environments">
            <material-tab label="{{env.code}} - {{env.label}}" ng-repeat="env in environments"
                          on-select="onTabSelected(env)"></material-tab>
        </material-tabs>

        <material-list>
            <material-item ng-repeat="param in envparameters | orderBy:['codeInstance', 'code']" ng-class="setClassError(param.todelete)">
                <div class="material-tile-left">
                    <div class="confman-list-param-app" ng-hide="param.codeInstance">APP</div>
                    <div class="confman-list-param-instance" ng-show="param.codeInstance">INS</div>
                </div>
                <div class="material-tile-content">
                    <div class="row">
                        <div class="col-md-2">
                            <h2>{{param.code}} :</h2>
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="data-param{{param.id}}" ng-model="param.label"
                                   class="form-control confman-input-param-env">
                        </div>
                        <div class="col-md-3">
                            <small>old value: {{param.oldValue}}</small>
                        </div>
                        <div class="col-md-3">
                            <small ng-show="param.todelete"><b>will be deleted on saving</b></small>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Application : {{param.codeApplication}} - tracking version :
                                {{param.codeTrackingVersion}}
                                <span ng-show="param.codeInstance">- instance : {{param.codeInstance}}</span>
                            </h3>
                        </div>
                    </div>
                </div>
                <div class="material-tile-right">
                    <material-checkbox>
                        <input type="checkbox" ng-model="param.todelete">
                    </material-checkbox>
                </div>
            </material-item>
        </material-list>

        <div class="modal-footer confman-btn" ng-show="versionTrackiCode">
            <button class="btn btn-primary" ng-click="saveParametersValues()">
                <img ng-src="img/icon/ic_save_24px.svg" title="Save"/>
            </button>
        </div>
    </form>
</material-content>

<script type="text/ng-template" id="modalConfirmCreation.html">
    <div class="modal-header">
        <h3 class="modal-title">Create new tracking version</h3>
    </div>
    <div class="modal-body">
        Are you sure you want to create a new version tracking for the app version {{appVersion}} ?
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok()">
            <img src="img/icon/ic_add_24px.svg" title="Create"/>
        </button>
        <button class="btn btn-default" ng-click="cancel()">
            <img src="img/icon/ic_clear_24px.svg" title="Cancel"/>
        </button>
    </div>
</script>